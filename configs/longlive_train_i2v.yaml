# LongLive I2V Training Configuration
# This configuration is for training with Image-to-Video support

# I2V mode
i2v: true
generator_name: Wan2.1-T2V-14B
real_name: Wan2.1-T2V-14B
fake_name: Wan2.1-T2V-1.3B

# FSDP strategies
generator_fsdp_wrap_strategy: size
real_score_fsdp_wrap_strategy: size
fake_score_fsdp_wrap_strategy: size
text_encoder_fsdp_wrap_strategy: size
image_encoder_fsdp_wrap_strategy: size
image_encoder_cpu_offload: false

# Denoising steps
denoising_step_list:
- 1000
- 750
- 500
- 250
warp_denoising_step: true
ts_schedule: false
num_train_timestep: 1000
timestep_shift: 5.0
guidance_scale: 3.0
denoising_loss_type: flow

# Training settings
mixed_precision: true
seed: 0
wandb_key: YOUR_WANDB_KEY
wandb_entity: YOUR_WANDB_ENTITY
wandb_project: YOUR_WANDB_PROJECT
sharding_strategy: hybrid_full

# Optimizer
lr: 2.0e-06
lr_critic: 4.0e-07
beta1: 0.0
beta2: 0.999
beta1_critic: 0.0
beta2_critic: 0.999
weight_decay: 0.0

# Data - I2V mode uses sharded LMDB dataset
data_path: path/to/i2v_lmdb_data/

# Training parameters
batch_size: 1
gradient_accumulation_steps: 1
ema_weight: 0.99
ema_start_step: 200
total_batch_size: 64
log_iters: 100
max_checkpoints: 5
max_iters: 3000

negative_prompt: '色调艳丽，过曝，静态，细节模糊不清，字幕，风格，作品，画作，画面，静止，整体发灰，最差质量，低质量，JPEG压缩残留，丑陋的，残缺的，多余的手指，画得不好的手部，画得不好的脸部，畸形的，毁容的，形态畸形的肢体，手指融合，静止不动的画面，杂乱的背景，三条腿，背景人很多，倒着走'
dfake_gen_update_ratio: 5

# Video shape: [batch, frames, channels, height, width]
image_or_video_shape:
- 1
- 21
- 16
- 60
- 104

# Training configuration
distribution_loss: dmd
trainer: score_distillation
gradient_checkpointing: true
num_frame_per_block: 3
load_raw_video: false
causal: true
disable_wandb: false

model_kwargs:
  timestep_shift: 5.0
  local_attn_size: 12
  sink_size: 3

# Visualization
vis_interval: 500
vis_ema: false
vis_video_lengths:
- 21
val_batch_size: 1
val_data_path: path/to/i2v_lmdb_val_data/

# Frame configuration
min_num_training_frames: 21
num_training_frames: 21
slice_last_frames: 21
independent_first_frame: true
same_step_across_blocks: true
last_step_only: false
context_noise: 0
